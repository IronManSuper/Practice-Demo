{"version":3,"sources":["hoister.js"],"names":[],"mappings":"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","file":"hoister-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar referenceVisitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (path.isJSXIdentifier() && _babelTypes.react.isCompatTag(path.node.name)) {\n      return;\n    }\n\n    var binding = path.scope.getBinding(path.node.name);\n    if (!binding) return;\n\n    if (binding !== state.scope.getBinding(path.node.name)) return;\n\n    if (binding.constant) {\n      state.bindings[path.node.name] = binding;\n    } else {\n      for (var _iterator = binding.constantViolations, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n        var _ref;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref = _i.value;\n        }\n\n        var violationPath = _ref;\n\n        state.breakOnScopePaths = state.breakOnScopePaths.concat(violationPath.getAncestry());\n      }\n    }\n  }\n};\n\nvar PathHoister = function () {\n  function PathHoister(path, scope) {\n    (0, _classCallCheck3.default)(this, PathHoister);\n\n    this.breakOnScopePaths = [];\n    this.bindings = {};\n    this.scopes = [];\n    this.scope = scope;\n    this.path = path;\n  }\n\n  PathHoister.prototype.isCompatibleScope = function isCompatibleScope(scope) {\n    for (var key in this.bindings) {\n      var binding = this.bindings[key];\n      if (!scope.bindingIdentifierEquals(key, binding.identifier)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  PathHoister.prototype.getCompatibleScopes = function getCompatibleScopes() {\n    var scope = this.path.scope;\n    do {\n      if (this.isCompatibleScope(scope)) {\n        this.scopes.push(scope);\n      } else {\n        break;\n      }\n\n      if (this.breakOnScopePaths.indexOf(scope.path) >= 0) {\n        break;\n      }\n    } while (scope = scope.parent);\n  };\n\n  PathHoister.prototype.getAttachmentPath = function getAttachmentPath() {\n    var path = this._getAttachmentPath();\n    if (!path) return;\n\n    var targetScope = path.scope;\n\n    if (targetScope.path === path) {\n      targetScope = path.scope.parent;\n    }\n\n    if (targetScope.path.isProgram() || targetScope.path.isFunction()) {\n      for (var name in this.bindings) {\n        if (!targetScope.hasOwnBinding(name)) continue;\n\n        var binding = this.bindings[name];\n\n        if (binding.kind === \"param\") continue;\n\n        if (this.getAttachmentParentForPath(binding.path).key > path.key) return;\n      }\n    }\n\n    return path;\n  };\n\n  PathHoister.prototype._getAttachmentPath = function _getAttachmentPath() {\n    var scopes = this.scopes;\n\n    var scope = scopes.pop();\n    if (!scope) return;\n\n    if (scope.path.isFunction()) {\n      if (this.hasOwnParamBindings(scope)) {\n        if (this.scope === scope) return;\n\n        return scope.path.get(\"body\").get(\"body\")[0];\n      } else {\n        return this.getNextScopeAttachmentParent();\n      }\n    } else if (scope.path.isProgram()) {\n      return this.getNextScopeAttachmentParent();\n    }\n  };\n\n  PathHoister.prototype.getNextScopeAttachmentParent = function getNextScopeAttachmentParent() {\n    var scope = this.scopes.pop();\n    if (scope) return this.getAttachmentParentForPath(scope.path);\n  };\n\n  PathHoister.prototype.getAttachmentParentForPath = function getAttachmentParentForPath(path) {\n    do {\n      if (!path.parentPath || Array.isArray(path.container) && path.isStatement() || path.isVariableDeclarator() && path.parentPath.node !== null && path.parentPath.node.declarations.length > 1) return path;\n    } while (path = path.parentPath);\n  };\n\n  PathHoister.prototype.hasOwnParamBindings = function hasOwnParamBindings(scope) {\n    for (var name in this.bindings) {\n      if (!scope.hasOwnBinding(name)) continue;\n\n      var binding = this.bindings[name];\n      if (binding.kind === \"param\") return true;\n    }\n    return false;\n  };\n\n  PathHoister.prototype.run = function run() {\n    var node = this.path.node;\n    if (node._hoisted) return;\n    node._hoisted = true;\n\n    this.path.traverse(referenceVisitor, this);\n\n    this.getCompatibleScopes();\n\n    var attachTo = this.getAttachmentPath();\n    if (!attachTo) return;\n\n    if (attachTo.getFunctionParent() === this.path.getFunctionParent()) return;\n\n    var uid = attachTo.scope.generateUidIdentifier(\"ref\");\n    var declarator = t.variableDeclarator(uid, this.path.node);\n\n    attachTo.insertBefore([attachTo.isVariableDeclarator() ? declarator : t.variableDeclaration(\"var\", [declarator])]);\n\n    var parent = this.path.parentPath;\n    if (parent.isJSXElement() && this.path.container === parent.node.children) {\n      uid = t.JSXExpressionContainer(uid);\n    }\n\n    this.path.replaceWith(uid);\n  };\n\n  return PathHoister;\n}();\n\nexports.default = PathHoister;\nmodule.exports = exports[\"default\"];"]}