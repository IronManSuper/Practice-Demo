{"version":3,"sources":["context.js"],"names":[],"mappings":"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","file":"context-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.call = call;\nexports._call = _call;\nexports.isBlacklisted = isBlacklisted;\nexports.visit = visit;\nexports.skip = skip;\nexports.skipKey = skipKey;\nexports.stop = stop;\nexports.setScope = setScope;\nexports.setContext = setContext;\nexports.resync = resync;\nexports._resyncParent = _resyncParent;\nexports._resyncKey = _resyncKey;\nexports._resyncList = _resyncList;\nexports._resyncRemoved = _resyncRemoved;\nexports.popContext = popContext;\nexports.pushContext = pushContext;\nexports.setup = setup;\nexports.setKey = setKey;\nexports.requeue = requeue;\nexports._getQueueContexts = _getQueueContexts;\n\nvar _index = require(\"../index\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction call(key) {\n  var opts = this.opts;\n\n  this.debug(function () {\n    return key;\n  });\n\n  if (this.node) {\n    if (this._call(opts[key])) return true;\n  }\n\n  if (this.node) {\n    return this._call(opts[this.node.type] && opts[this.node.type][key]);\n  }\n\n  return false;\n}\n\nfunction _call(fns) {\n  if (!fns) return false;\n\n  for (var _iterator = fns, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i >= _iterator.length) break;\n      _ref = _iterator[_i++];\n    } else {\n      _i = _iterator.next();\n      if (_i.done) break;\n      _ref = _i.value;\n    }\n\n    var fn = _ref;\n\n    if (!fn) continue;\n\n    var node = this.node;\n    if (!node) return true;\n\n    var ret = fn.call(this.state, this, this.state);\n    if (ret) throw new Error(\"Unexpected return value from visitor method \" + fn);\n\n    if (this.node !== node) return true;\n\n    if (this.shouldStop || this.shouldSkip || this.removed) return true;\n  }\n\n  return false;\n}\n\nfunction isBlacklisted() {\n  var blacklist = this.opts.blacklist;\n  return blacklist && blacklist.indexOf(this.node.type) > -1;\n}\n\nfunction visit() {\n  if (!this.node) {\n    return false;\n  }\n\n  if (this.isBlacklisted()) {\n    return false;\n  }\n\n  if (this.opts.shouldSkip && this.opts.shouldSkip(this)) {\n    return false;\n  }\n\n  if (this.call(\"enter\") || this.shouldSkip) {\n    this.debug(function () {\n      return \"Skip...\";\n    });\n    return this.shouldStop;\n  }\n\n  this.debug(function () {\n    return \"Recursing into...\";\n  });\n  _index2.default.node(this.node, this.opts, this.scope, this.state, this, this.skipKeys);\n\n  this.call(\"exit\");\n\n  return this.shouldStop;\n}\n\nfunction skip() {\n  this.shouldSkip = true;\n}\n\nfunction skipKey(key) {\n  this.skipKeys[key] = true;\n}\n\nfunction stop() {\n  this.shouldStop = true;\n  this.shouldSkip = true;\n}\n\nfunction setScope() {\n  if (this.opts && this.opts.noScope) return;\n\n  var target = this.context && this.context.scope;\n\n  if (!target) {\n    var path = this.parentPath;\n    while (path && !target) {\n      if (path.opts && path.opts.noScope) return;\n\n      target = path.scope;\n      path = path.parentPath;\n    }\n  }\n\n  this.scope = this.getScope(target);\n  if (this.scope) this.scope.init();\n}\n\nfunction setContext(context) {\n  this.shouldSkip = false;\n  this.shouldStop = false;\n  this.removed = false;\n  this.skipKeys = {};\n\n  if (context) {\n    this.context = context;\n    this.state = context.state;\n    this.opts = context.opts;\n  }\n\n  this.setScope();\n\n  return this;\n}\n\nfunction resync() {\n  if (this.removed) return;\n\n  this._resyncParent();\n  this._resyncList();\n  this._resyncKey();\n}\n\nfunction _resyncParent() {\n  if (this.parentPath) {\n    this.parent = this.parentPath.node;\n  }\n}\n\nfunction _resyncKey() {\n  if (!this.container) return;\n\n  if (this.node === this.container[this.key]) return;\n\n  if (Array.isArray(this.container)) {\n    for (var i = 0; i < this.container.length; i++) {\n      if (this.container[i] === this.node) {\n        return this.setKey(i);\n      }\n    }\n  } else {\n    for (var key in this.container) {\n      if (this.container[key] === this.node) {\n        return this.setKey(key);\n      }\n    }\n  }\n\n  this.key = null;\n}\n\nfunction _resyncList() {\n  if (!this.parent || !this.inList) return;\n\n  var newContainer = this.parent[this.listKey];\n  if (this.container === newContainer) return;\n\n  this.container = newContainer || null;\n}\n\nfunction _resyncRemoved() {\n  if (this.key == null || !this.container || this.container[this.key] !== this.node) {\n    this._markRemoved();\n  }\n}\n\nfunction popContext() {\n  this.contexts.pop();\n  this.setContext(this.contexts[this.contexts.length - 1]);\n}\n\nfunction pushContext(context) {\n  this.contexts.push(context);\n  this.setContext(context);\n}\n\nfunction setup(parentPath, container, listKey, key) {\n  this.inList = !!listKey;\n  this.listKey = listKey;\n  this.parentKey = listKey || key;\n  this.container = container;\n\n  this.parentPath = parentPath || this.parentPath;\n  this.setKey(key);\n}\n\nfunction setKey(key) {\n  this.key = key;\n  this.node = this.container[this.key];\n  this.type = this.node && this.node.type;\n}\n\nfunction requeue() {\n  var pathToQueue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this;\n\n  if (pathToQueue.removed) return;\n\n  var contexts = this.contexts;\n\n  for (var _iterator2 = contexts, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n    var _ref2;\n\n    if (_isArray2) {\n      if (_i2 >= _iterator2.length) break;\n      _ref2 = _iterator2[_i2++];\n    } else {\n      _i2 = _iterator2.next();\n      if (_i2.done) break;\n      _ref2 = _i2.value;\n    }\n\n    var context = _ref2;\n\n    context.maybeQueue(pathToQueue);\n  }\n}\n\nfunction _getQueueContexts() {\n  var path = this;\n  var contexts = this.contexts;\n  while (!contexts.length) {\n    path = path.parentPath;\n    contexts = path.contexts;\n  }\n  return contexts;\n}"]}