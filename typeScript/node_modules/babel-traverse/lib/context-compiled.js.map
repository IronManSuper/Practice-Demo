{"version":3,"sources":["context.js"],"names":[],"mappings":"AAAA;;AAEA,QAAQ,UAAR,GAAqB,IAArB;;AAEA,IAAI,gBAAgB,QAAQ,oCAAR,CAApB;;AAEA,IAAI,gBAAgB,uBAAuB,aAAvB,CAApB;;AAEA,IAAI,mBAAmB,QAAQ,sCAAR,CAAvB;;AAEA,IAAI,mBAAmB,uBAAuB,gBAAvB,CAAvB;;AAEA,IAAI,SAAS,QAAQ,QAAR,CAAb;;AAEA,IAAI,SAAS,uBAAuB,MAAvB,CAAb;;AAEA,IAAI,cAAc,QAAQ,aAAR,CAAlB;;AAEA,IAAI,IAAI,wBAAwB,WAAxB,CAAR;;AAEA,SAAS,uBAAT,CAAiC,GAAjC,EAAsC;AAAE,MAAI,OAAO,IAAI,UAAf,EAA2B;AAAE,WAAO,GAAP;AAAa,GAA1C,MAAgD;AAAE,QAAI,SAAS,EAAb,CAAiB,IAAI,OAAO,IAAX,EAAiB;AAAE,WAAK,IAAI,GAAT,IAAgB,GAAhB,EAAqB;AAAE,YAAI,OAAO,SAAP,CAAiB,cAAjB,CAAgC,IAAhC,CAAqC,GAArC,EAA0C,GAA1C,CAAJ,EAAoD,OAAO,GAAP,IAAc,IAAI,GAAJ,CAAd;AAAyB;AAAE,KAAC,OAAO,OAAP,GAAiB,GAAjB,CAAsB,OAAO,MAAP;AAAgB;AAAE;;AAE7Q,SAAS,sBAAT,CAAgC,GAAhC,EAAqC;AAAE,SAAO,OAAO,IAAI,UAAX,GAAwB,GAAxB,GAA8B,EAAE,SAAS,GAAX,EAArC;AAAwD;;AAE/F,IAAI,UAAU,QAAQ,GAAR,CAAY,QAAZ,KAAyB,MAAvC;;AAEA,IAAI,mBAAmB,YAAY;AACjC,WAAS,gBAAT,CAA0B,KAA1B,EAAiC,IAAjC,EAAuC,KAAvC,EAA8C,UAA9C,EAA0D;AACxD,KAAC,GAAG,iBAAiB,OAArB,EAA8B,IAA9B,EAAoC,gBAApC;AACA,SAAK,KAAL,GAAa,IAAb;;AAEA,SAAK,UAAL,GAAkB,UAAlB;AACA,SAAK,KAAL,GAAa,KAAb;AACA,SAAK,KAAL,GAAa,KAAb;AACA,SAAK,IAAL,GAAY,IAAZ;AACD;;AAED,mBAAiB,SAAjB,CAA2B,WAA3B,GAAyC,SAAS,WAAT,CAAqB,IAArB,EAA2B;AAClE,QAAI,OAAO,KAAK,IAAhB;AACA,QAAI,KAAK,KAAL,IAAc,KAAK,IAAvB,EAA6B,OAAO,IAAP;;AAE7B,QAAI,KAAK,KAAK,IAAV,CAAJ,EAAqB,OAAO,IAAP;;AAErB,QAAI,OAAO,EAAE,YAAF,CAAe,KAAK,IAApB,CAAX;AACA,QAAI,CAAC,IAAD,IAAS,CAAC,KAAK,MAAnB,EAA2B,OAAO,KAAP;;AAE3B,SAAK,IAAI,YAAY,IAAhB,EAAsB,WAAW,MAAM,OAAN,CAAc,SAAd,CAAjC,EAA2D,KAAK,CAAhE,EAAmE,YAAY,WAAW,SAAX,GAAuB,CAAC,GAAG,cAAc,OAAlB,EAA2B,SAA3B,CAA3G,IAAoJ;AAClJ,UAAI,IAAJ;;AAEA,UAAI,QAAJ,EAAc;AACZ,YAAI,MAAM,UAAU,MAApB,EAA4B;AAC5B,eAAO,UAAU,IAAV,CAAP;AACD,OAHD,MAGO;AACL,aAAK,UAAU,IAAV,EAAL;AACA,YAAI,GAAG,IAAP,EAAa;AACb,eAAO,GAAG,KAAV;AACD;;AAED,UAAI,MAAM,IAAV;;AAEA,UAAI,KAAK,GAAL,CAAJ,EAAe,OAAO,IAAP;AAChB;;AAED,WAAO,KAAP;AACD,GA3BD;;AA6BA,mBAAiB,SAAjB,CAA2B,MAA3B,GAAoC,SAAS,MAAT,CAAgB,IAAhB,EAAsB,GAAtB,EAA2B,GAA3B,EAAgC,OAAhC,EAAyC;AAC3E,WAAO,OAAO,OAAP,CAAe,GAAf,CAAmB;AACxB,kBAAY,KAAK,UADO;AAExB,cAAQ,IAFgB;AAGxB,iBAAW,GAHa;AAIxB,WAAK,GAJmB;AAKxB,eAAS;AALe,KAAnB,CAAP;AAOD,GARD;;AAUA,mBAAiB,SAAjB,CAA2B,UAA3B,GAAwC,SAAS,UAAT,CAAoB,IAApB,EAA0B,WAA1B,EAAuC;AAC7E,QAAI,KAAK,IAAT,EAAe;AACb,YAAM,IAAI,KAAJ,CAAU,yBAAV,CAAN;AACD;;AAED,QAAI,KAAK,KAAT,EAAgB;AACd,UAAI,WAAJ,EAAiB;AACf,aAAK,KAAL,CAAW,IAAX,CAAgB,IAAhB;AACD,OAFD,MAEO;AACL,aAAK,aAAL,CAAmB,IAAnB,CAAwB,IAAxB;AACD;AACF;AACF,GAZD;;AAcA,mBAAiB,SAAjB,CAA2B,aAA3B,GAA2C,SAAS,aAAT,CAAuB,SAAvB,EAAkC,MAAlC,EAA0C,OAA1C,EAAmD;AAC5F,QAAI,UAAU,MAAV,KAAqB,CAAzB,EAA4B,OAAO,KAAP;;AAE5B,QAAI,QAAQ,EAAZ;;AAEA,SAAK,IAAI,MAAM,CAAf,EAAkB,MAAM,UAAU,MAAlC,EAA0C,KAA1C,EAAiD;AAC/C,UAAI,OAAO,UAAU,GAAV,CAAX;AACA,UAAI,QAAQ,KAAK,WAAL,CAAiB,IAAjB,CAAZ,EAAoC;AAClC,cAAM,IAAN,CAAW,KAAK,MAAL,CAAY,MAAZ,EAAoB,SAApB,EAA+B,GAA/B,EAAoC,OAApC,CAAX;AACD;AACF;;AAED,WAAO,KAAK,UAAL,CAAgB,KAAhB,CAAP;AACD,GAbD;;AAeA,mBAAiB,SAAjB,CAA2B,WAA3B,GAAyC,SAAS,WAAT,CAAqB,IAArB,EAA2B,GAA3B,EAAgC;AACvE,QAAI,KAAK,WAAL,CAAiB,KAAK,GAAL,CAAjB,CAAJ,EAAiC;AAC/B,aAAO,KAAK,UAAL,CAAgB,CAAC,KAAK,MAAL,CAAY,IAAZ,EAAkB,IAAlB,EAAwB,GAAxB,CAAD,CAAhB,CAAP;AACD,KAFD,MAEO;AACL,aAAO,KAAP;AACD;AACF,GAND;;AAQA,mBAAiB,SAAjB,CAA2B,UAA3B,GAAwC,SAAS,UAAT,CAAoB,KAApB,EAA2B;AACjE,SAAK,KAAL,GAAa,KAAb;AACA,SAAK,aAAL,GAAqB,EAArB;;AAEA,QAAI,UAAU,EAAd;AACA,QAAI,OAAO,KAAX;;AAEA,SAAK,IAAI,aAAa,KAAjB,EAAwB,YAAY,MAAM,OAAN,CAAc,UAAd,CAApC,EAA+D,MAAM,CAArE,EAAwE,aAAa,YAAY,UAAZ,GAAyB,CAAC,GAAG,cAAc,OAAlB,EAA2B,UAA3B,CAAnH,IAA6J;AAC3J,UAAI,KAAJ;;AAEA,UAAI,SAAJ,EAAe;AACb,YAAI,OAAO,WAAW,MAAtB,EAA8B;AAC9B,gBAAQ,WAAW,KAAX,CAAR;AACD,OAHD,MAGO;AACL,cAAM,WAAW,IAAX,EAAN;AACA,YAAI,IAAI,IAAR,EAAc;AACd,gBAAQ,IAAI,KAAZ;AACD;;AAED,UAAI,OAAO,KAAX;;AAEA,WAAK,MAAL;;AAEA,UAAI,KAAK,QAAL,CAAc,MAAd,KAAyB,CAAzB,IAA8B,KAAK,QAAL,CAAc,KAAK,QAAL,CAAc,MAAd,GAAuB,CAArC,MAA4C,IAA9E,EAAoF;AAClF,aAAK,WAAL,CAAiB,IAAjB;AACD;;AAED,UAAI,KAAK,GAAL,KAAa,IAAjB,EAAuB;;AAEvB,UAAI,WAAW,MAAM,MAAN,IAAgB,KAA/B,EAAsC;AACpC,aAAK,IAAL,GAAY,IAAZ;AACD;;AAED,UAAI,QAAQ,OAAR,CAAgB,KAAK,IAArB,KAA8B,CAAlC,EAAqC;AACrC,cAAQ,IAAR,CAAa,KAAK,IAAlB;;AAEA,UAAI,KAAK,KAAL,EAAJ,EAAkB;AAChB,eAAO,IAAP;AACA;AACD;;AAED,UAAI,KAAK,aAAL,CAAmB,MAAvB,EAA+B;AAC7B,eAAO,KAAK,UAAL,CAAgB,KAAK,aAArB,CAAP;AACA,aAAK,aAAL,GAAqB,EAArB;AACA,aAAK,KAAL,GAAa,KAAb;AACA,YAAI,IAAJ,EAAU;AACX;AACF;;AAED,SAAK,IAAI,aAAa,KAAjB,EAAwB,YAAY,MAAM,OAAN,CAAc,UAAd,CAApC,EAA+D,MAAM,CAArE,EAAwE,aAAa,YAAY,UAAZ,GAAyB,CAAC,GAAG,cAAc,OAAlB,EAA2B,UAA3B,CAAnH,IAA6J;AAC3J,UAAI,KAAJ;;AAEA,UAAI,SAAJ,EAAe;AACb,YAAI,OAAO,WAAW,MAAtB,EAA8B;AAC9B,gBAAQ,WAAW,KAAX,CAAR;AACD,OAHD,MAGO;AACL,cAAM,WAAW,IAAX,EAAN;AACA,YAAI,IAAI,IAAR,EAAc;AACd,gBAAQ,IAAI,KAAZ;AACD;;AAED,UAAI,QAAQ,KAAZ;;AAEA,YAAM,UAAN;AACD;;AAED,SAAK,KAAL,GAAa,IAAb;;AAEA,WAAO,IAAP;AACD,GArED;;AAuEA,mBAAiB,SAAjB,CAA2B,KAA3B,GAAmC,SAAS,KAAT,CAAe,IAAf,EAAqB,GAArB,EAA0B;AAC3D,QAAI,QAAQ,KAAK,GAAL,CAAZ;AACA,QAAI,CAAC,KAAL,EAAY,OAAO,KAAP;;AAEZ,QAAI,MAAM,OAAN,CAAc,KAAd,CAAJ,EAA0B;AACxB,aAAO,KAAK,aAAL,CAAmB,KAAnB,EAA0B,IAA1B,EAAgC,GAAhC,CAAP;AACD,KAFD,MAEO;AACL,aAAO,KAAK,WAAL,CAAiB,IAAjB,EAAuB,GAAvB,CAAP;AACD;AACF,GATD;;AAWA,SAAO,gBAAP;AACD,CA1KsB,EAAvB;;AA4KA,QAAQ,OAAR,GAAkB,gBAAlB;AACA,OAAO,OAAP,GAAiB,QAAQ,SAAR,CAAjB","file":"context-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _path2 = require(\"./path\");\n\nvar _path3 = _interopRequireDefault(_path2);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar testing = process.env.NODE_ENV === \"test\";\n\nvar TraversalContext = function () {\n  function TraversalContext(scope, opts, state, parentPath) {\n    (0, _classCallCheck3.default)(this, TraversalContext);\n    this.queue = null;\n\n    this.parentPath = parentPath;\n    this.scope = scope;\n    this.state = state;\n    this.opts = opts;\n  }\n\n  TraversalContext.prototype.shouldVisit = function shouldVisit(node) {\n    var opts = this.opts;\n    if (opts.enter || opts.exit) return true;\n\n    if (opts[node.type]) return true;\n\n    var keys = t.VISITOR_KEYS[node.type];\n    if (!keys || !keys.length) return false;\n\n    for (var _iterator = keys, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var key = _ref;\n\n      if (node[key]) return true;\n    }\n\n    return false;\n  };\n\n  TraversalContext.prototype.create = function create(node, obj, key, listKey) {\n    return _path3.default.get({\n      parentPath: this.parentPath,\n      parent: node,\n      container: obj,\n      key: key,\n      listKey: listKey\n    });\n  };\n\n  TraversalContext.prototype.maybeQueue = function maybeQueue(path, notPriority) {\n    if (this.trap) {\n      throw new Error(\"Infinite cycle detected\");\n    }\n\n    if (this.queue) {\n      if (notPriority) {\n        this.queue.push(path);\n      } else {\n        this.priorityQueue.push(path);\n      }\n    }\n  };\n\n  TraversalContext.prototype.visitMultiple = function visitMultiple(container, parent, listKey) {\n    if (container.length === 0) return false;\n\n    var queue = [];\n\n    for (var key = 0; key < container.length; key++) {\n      var node = container[key];\n      if (node && this.shouldVisit(node)) {\n        queue.push(this.create(parent, container, key, listKey));\n      }\n    }\n\n    return this.visitQueue(queue);\n  };\n\n  TraversalContext.prototype.visitSingle = function visitSingle(node, key) {\n    if (this.shouldVisit(node[key])) {\n      return this.visitQueue([this.create(node, node, key)]);\n    } else {\n      return false;\n    }\n  };\n\n  TraversalContext.prototype.visitQueue = function visitQueue(queue) {\n    this.queue = queue;\n    this.priorityQueue = [];\n\n    var visited = [];\n    var stop = false;\n\n    for (var _iterator2 = queue, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var path = _ref2;\n\n      path.resync();\n\n      if (path.contexts.length === 0 || path.contexts[path.contexts.length - 1] !== this) {\n        path.pushContext(this);\n      }\n\n      if (path.key === null) continue;\n\n      if (testing && queue.length >= 10000) {\n        this.trap = true;\n      }\n\n      if (visited.indexOf(path.node) >= 0) continue;\n      visited.push(path.node);\n\n      if (path.visit()) {\n        stop = true;\n        break;\n      }\n\n      if (this.priorityQueue.length) {\n        stop = this.visitQueue(this.priorityQueue);\n        this.priorityQueue = [];\n        this.queue = queue;\n        if (stop) break;\n      }\n    }\n\n    for (var _iterator3 = queue, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : (0, _getIterator3.default)(_iterator3);;) {\n      var _ref3;\n\n      if (_isArray3) {\n        if (_i3 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i3++];\n      } else {\n        _i3 = _iterator3.next();\n        if (_i3.done) break;\n        _ref3 = _i3.value;\n      }\n\n      var _path = _ref3;\n\n      _path.popContext();\n    }\n\n    this.queue = null;\n\n    return stop;\n  };\n\n  TraversalContext.prototype.visit = function visit(node, key) {\n    var nodes = node[key];\n    if (!nodes) return false;\n\n    if (Array.isArray(nodes)) {\n      return this.visitMultiple(nodes, node, key);\n    } else {\n      return this.visitSingle(node, key);\n    }\n  };\n\n  return TraversalContext;\n}();\n\nexports.default = TraversalContext;\nmodule.exports = exports[\"default\"];"]}